#!/bin/bash
# Clipper Worker Launcher - triggered by clipperworker:// URL scheme
# Only starts one worker - reuses existing if already running

# Check if worker is already running
EXISTING_PID=$(pgrep -f "run_worker.py.*railway" 2>/dev/null | head -1)
if [ -n "$EXISTING_PID" ]; then
    # Worker already running - just bring terminal to front
    osascript -e 'tell application "Terminal" to activate'
    exit 0
fi

# Get the directory where the app bundle is located
APP_DIR="$(dirname "$(dirname "$(dirname "$0")")")"
PROJECT_DIR="$(dirname "$APP_DIR")"

# If project dir doesn't have run_worker.py, try to find it
if [ ! -f "$PROJECT_DIR/run_worker.py" ]; then
    if [ -f "$HOME/instagram post creator/run_worker.py" ]; then
        PROJECT_DIR="$HOME/instagram post creator"
    elif [ -f "$HOME/Desktop/instagram post creator/run_worker.py" ]; then
        PROJECT_DIR="$HOME/Desktop/instagram post creator"
    elif [ -f "$HOME/Documents/instagram post creator/run_worker.py" ]; then
        PROJECT_DIR="$HOME/Documents/instagram post creator"
    fi
fi

# Open Terminal and run the worker
osascript <<EOF
tell application "Terminal"
    activate
    do script "cd \"$PROJECT_DIR\" && ./\"Start Worker.command\""
end tell
EOF
